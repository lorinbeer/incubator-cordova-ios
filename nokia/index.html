<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title> Sample Widget</title>
		<!-- embed type="application/x-systeminfo-widget" hidden="yes"></embed -->	
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/phonegap-interface.js"></script>
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/nokia/device.js"></script>
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/nokia/geolocation.js"></script>
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/nokia/notification.js"></script>
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/nokia/contact.js"></script>
		<script language="javascript" type="text/javascript" src="javascripts/phonegap/nokia/accelerometer.js"></script>
		<link rel="stylesheet" href="master.css" type="text/css" media="screen" title="no title" charset="utf-8">		
    	<META NAME="Generator" CONTENT="Nokia WRT plug-in for Aptana Studio 2.0.0" />
		<script type="text/javascript">
			var myLocation;
			var myNotification;
			var myContactManager;
			var timeout = null;
			var displayState = 0;
			
			function start() {
				try {
					var options = new Object();
					options.frequency = 8000;
					timeout = setInterval("animate()", 500);
					myLocation.watchPosition(updateLocation, function() {}, options);
					
					myContactManager.getAllContacts(displayContacts, function() { alert('getallcontacts fail'); }, new Object());
					
					options.frequency = 1000;
					myAccelerometer.watchAcceleration(updateAcceleration, function () { alert('watch failed'); }, options);
				} catch (ex) {
					alert(ex.name + " " + ex.message);
				}
			}
			
			function init() {
				myNotification = new Notification();
				myLocation = new Geolocation();
				myContactManager = new ContactManager();
				myAccelerometer = new Accelerometer();
				start();
			}
			
			function updateLocation() {
				clearTimeout(timeout);
				//pt.latitude, pt.longitude, pt.altitude, pt.accuracy, pt.heading, pt.speed
				var pt = myLocation.lastPosition.coords;
				document.getElementById('latitude').innerHTML = pt.latitude;
				document.getElementById('longitude').innerHTML = pt.longitude;
				document.getElementById('altitude').innerHTML = pt.altitude;
				document.getElementById('heading').innerHTML = pt.heading;
				document.getElementById('speed').innerHTML = pt.speed;
			}
			
			function updateAcceleration(accel) {
				document.getElementById('accel_x').innerHTML = accel.x;
				document.getElementById('accel_y').innerHTML = accel.y;
				document.getElementById('accel_z').innerHTML = accel.z;
			}
			
			function displayContacts() {
				var contacts = myContactManager.contacts;
				var output = "";
				for (var i=0; i<contacts.length; i++) {
					output += 	"<div class='list-item'>" + contacts[i].firstName + " " + contacts[i].lastName +
								"<span class='list-item-small'> Phone: " + contacts[i].phones["Mobile"] +
								"</div>";
				}
				document.getElementById('contacts').innerHTML = output;
			}
			
			function vibrate() {
				try {
					myNotification.vibrate(2000);
					myNotification.beep(2000, 100);
				} catch (ex) {
					alert(ex.name + ": " + ex.message);
				}
			}
			
			function animate() {
				switch (displayState) {
					case 0:
						displayStatus('finding satellites.');
						displayState = 1;
						break;
					case 1:
						displayStatus('finding satellites..');
						displayState = 2;
						break;
					case 2:
						displayStatus('finding satellites...');
						displayState = 3;
						break;
					case 3:
						displayStatus('finding satellites');
						displayState = 0;
						break;
						
				}
			}
			
			function displayStatus(status) {
				document.getElementById('latitude').innerHTML = status;
				document.getElementById('longitude').innerHTML = status;
				document.getElementById('altitude').innerHTML = status;
				document.getElementById('heading').innerHTML = status;
				document.getElementById('speed').innerHTML = status;
			}
			
		</script>
	</head>
	<body onload="javascript:init();">
		<div class="header">phonegap nokia</div>
		Geolocation
		<div class="list">
			<div class="list-item">latitude: <span id="latitude">finding satellites</span></div>
			<div class="list-item">longitude: <span id="longitude">finding satellites</span></div>
			<div class="list-item">altitude: <span id="altitude">finding satellites</span></div>
			<div class="list-item">heading: <span id="heading">finding satellites</span></div>
			<div class="list-item">speed: <span id="speed">finding satellites</span></div>
		</div>
		Accelerometer
		<div class="list">
			<div class="list-item">X-Accel: <span id="accel_x"></span></div>
			<div class="list-item">Y-Accel: <span id="accel_y"></span></div>
			<div class="list-item">Z-Accel: <span id="accel_z"></span></div>
		</div>
		Contacts
		<div id="contacts" class="contacts"></div>
		<div class="list-item"><a href="javascript:vibrate();">Notification (vibrate)</a></div>
		<a href="javascript:widget.openURL('http://www.nitobi.com');"><img src="assets/nitobi-avatar.png" class="nitobi-logo" /></a>
	</body>
</html>
